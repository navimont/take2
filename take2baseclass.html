<!doctype html>
<html>
  <head>
		<meta charset="utf-8"/>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="description" content="Linked Address Book"/>
    <!-- Opengraph.org tags -->
    <meta property="og:title" content="Take2 - Linked Address Book" />
    <meta property="og:type" content="non_profit" />
    <meta property="og:url" content="http://www.navimont.com/" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content=""/>
    <!-- weschnitz browser tab icon -->
    <!-- <link rel="shortcut icon" href=""> -->

    <!-- Stylesheets -->
		<link rel="stylesheet" media="all" href="static/take2.css"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>{% block pagetitle %}{% endblock %}</title>

    <!-- style sheet and sources for jquery autocomplete -->
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    <script type="text/javascript">
      function post_to_url(path, params, method) {
          method = method || "get";

          var form = document.createElement("form");
          form.setAttribute("method", method);
          form.setAttribute("action", path);

          for(var key in params) {
              var hiddenField = document.createElement("input");
              hiddenField.setAttribute("type", "hidden");
              hiddenField.setAttribute("name", key);
              hiddenField.setAttribute("value", params[key]);

              form.appendChild(hiddenField);
          }

          document.body.appendChild(form);
          form.submit();
      }

      var georequest = new XMLHttpRequest();

      function position_error_cb (err) {
          var user = $("[name='login_user_key']").val();
          var url = "/location?user="+user+"&err="+err.code;
          georequest.open("GET", url, true);
          // we are not interested in any reply
          georequest.send(null);
      }

      function position_cb (position) {
          var user = $("[name='login_user_key']").val();
          var url = "/location?user="+user+"&lat="+position.coords.latitude+"&lon="+position.coords.longitude;
          georequest.open("GET", url, true);
          // we are not interested in any reply
          georequest.send(null);
      }

      function locate_me() {
          if (!navigator.geolocation) {
              return;
          }
          // maximumAge in milliseconds
          navigator.geolocation.getCurrentPosition(position_cb, position_error_cb, {timeout: 10000, maximumAge: 300000});
      }

      $(document).ready(function() {
          // auto-complete for search box
          $("input#autocomplete").autocomplete( {
              source: "/lookup"
              });
          ask_geolocation = $("[name='geolocation_request']").val()
          if (ask_geolocation == "True") {
              locate_me();
          }
      });
    </script>
  </head>

  <body lang="en">
    <header id="masthead">
      <nav>
        <ul>
          <li><a href="{{loginout_url}}">{{loginout_text}}</a></li>
          {% if signed_in %}
            <li><a href="javascript:void(0)" onClick="post_to_url('/newperson')">New contact</a></li>
          {% endif %}
        </ul>
      </nav>
      <a class="gigantic" href="/">Weschnitz</a>
      <p class="bigger">Simply an online address book.</p>
      <form name="search" action="/search" method="GET">
          <input type="hidden" name="geolocation_request" value="{{geolocation_request}}">
          <input type="hidden" name="login_user_key" value="{{login_user_key}}">
          <input type="hidden" value="search">
          <input id="autocomplete" type="text" name="query" value="{{ query|escape }}">
          <input type="submit" value="Search">
      </form>
    </header>
    <div id='page_content'>
        {% block content %} {% endblock %}
    </div>
  </body>
</html>

